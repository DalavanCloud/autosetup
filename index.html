<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.1" />
<title>autosetup v0.6.0&#8201;&#8212;&#8201;User Manual</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #dddddd;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-family: sans-serif;
  font-weight: bold;
  color: #527bbd;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes();}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>autosetup v0.6.0&#8201;&#8212;&#8201;User Manual</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_1_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p><em>autosetup</em> is a tool, similar to <em>autoconf</em>, to configure a build system for the appropriate environment, according to the system capabilities and the user configuration.</p></div>
<div class="paragraph"><p>autosetup is designed to be light-weight, fast, simple and flexible.</p></div>
<div class="paragraph"><p>Notable features include:</p></div>
<div class="ulist"><ul>
<li>
<p>
Easily check for headers, functions, types for C/C++
</p>
</li>
<li>
<p>
Easily support user configuration options
</p>
</li>
<li>
<p>
Can generate files based on templates, such as Makefile.in &#8658; Makefile
</p>
</li>
<li>
<p>
Can generate header files based on checked features
</p>
</li>
<li>
<p>
Excellent support for cross compilation
</p>
</li>
<li>
<p>
Replacement for autoconf in many situations
</p>
</li>
<li>
<p>
Runs with either Tcl 8.5+, Jim Tcl or just a C compiler (using the included Jim Tcl source code!)
</p>
</li>
<li>
<p>
autosetup is intended to be distributed with projects - no version issues
</p>
</li>
</ul></div>
<div class="paragraph"><p>autosetup is particularly targeted towards building C/C++ applications on Unix systems, however it can be extended for other environments as needed.</p></div>
<div class="paragraph"><p>autosetup is <strong>not</strong>:</p></div>
<div class="ulist"><ul>
<li>
<p>
A build system
</p>
</li>
<li>
<p>
A replacement for automake
</p>
</li>
<li>
<p>
Intended to replace all possible uses of autoconf
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_2_usage">2. Usage</h2>
<div class="sectionbody">
<div class="paragraph"><p>autosetup accepts both standard options as well as local options defined in the <em>auto.def</em> file, and options for modules. Use <em>autosetup --help</em> to show all available options.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>autosetup ?options? ?settings?</tt></pre>
</div></div>
<div class="paragraph"><p>Some important core options are:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>-C dir           change to the given directory before running autosetup
--help           display help and options
--version        display the version of autosetup
--manual?=text?  display the autosetup manual. Alternative formats are 'wiki' and 'asciidoc'
--install        install autosetup to the current directory
--init           create an initial 'configure' script if none exists</tt></pre>
</div></div>
<div class="paragraph"><p>Settings are of the form <em>name=value</em> and must be after any options. These settings allow the default values to be overridden for variables such as <em>CC</em> and <em>CFLAGS</em>.</p></div>
<div class="paragraph"><p>Optional modules may support additional options. For example, the cc module supports the following additional options.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>--host=host-alias     a complete or partial cpu-vendor-opsys for the system where the
                      application will run (defaults to the same value as --build)
--build=build-alias   a complete or partial cpu-vendor-opsys for the system where the
                      application will be built (defaults to the result of running
                      config.guess)
--prefix=dir          the target directory for the build (defaults to /usr/local)</tt></pre>
</div></div>
<div class="paragraph"><p>Typically, autosetup is invoked via a simpler wrapper script, <em>configure</em>. This provides for compatibility with autoconf. For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>./configure --host=arm-linux --utf8 --prefix=/usr CFLAGS="-g -Os"</tt></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_3_features">3. Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_3_1_configuration_descriptions_are_tcl">3.1. Configuration Descriptions are Tcl</h3>
<div class="paragraph"><p>Configuration requirements are given in an <em>auto.def</em> file and are written in <em>Tcl</em>, a language slightly less obscure than <em>m4</em>! As a full language, there are no additional dependencies on the host system such as <em>awk</em>, <em>sed</em> and <em>bash</em>.</p></div>
<div class="paragraph"><p>Tcl is widely available on modern development platforms. Configuration descriptions are designed to look more like declarations than code. It is easy to write autosetup configuration descriptions with no knowledge of Tcl.</p></div>
</div>
<div class="sect2">
<h3 id="_3_2_simple_configuration_descriptions">3.2. Simple Configuration Descriptions</h3>
<div class="paragraph"><p>A typical, simple auto.def file is:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>use cc</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>options {
    shared =&gt; "build a shared library"
    lineedit=1 =&gt; "disable line editing"
    utf8 =&gt; "enabled UTF-8 support"
    with-regexp regexp =&gt; "use regexp"
}</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>cc-check-types "long long"
cc-check-includes sys/un.h dlfcn.h
cc-check-functions ualarm sysinfo lstat fork vfork
cc-check-function-in-lib sqlite3_open sqlite3</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>if {[opt-bool utf8] &amp;&amp; [have-feature fork]} {
    msg-result "Enabling UTF-8"
    define JIM_UTF8
}
make-autoconf-h config.h
make-template Makefile.in</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_3_3_fast">3.3. Fast</h3>
<div class="paragraph"><p>All the processing occurs in a single process, aside from invocations of the C compiler. Here are the results of a typical configure for a small project. <em>autoconf</em> is particularly slow on <em>cygwin</em>.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>              autoconf     autosetup
              ---------    ---------
Linux            4.1s         1.3s
Mac OS X         6.4s         2.8s
cygwin          91.5s         9.9s</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_3_4_deploys_directly_within_a_project">3.4. Deploys directly within a project</h3>
<div class="paragraph"><p>autosetup is deployed as a single subdirectory, autosetup, at the top level of a project, containing a handful of files. This approach (inspired by waf - <a href="http://code.google.com/p/waf/">http://code.google.com/p/waf/</a>) means that there are no dependency issues with different versions of autosetup since an appropriate version is part of the project.</p></div>
<div class="paragraph"><p>autosetup is written in Tcl, but can run under any of the following Tcl interpreters:</p></div>
<div class="ulist"><ul>
<li>
<p>
Tcl 8.5 or later
</p>
</li>
<li>
<p>
Jim Tcl - a small footprint, portable Tcl interpreter
</p>
</li>
</ul></div>
<div class="paragraph"><p>The source code for Jim Tcl is included directly within autosetup and is automatically built if no other Tcl interpreter is available.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ ./configure --help
No installed jimsh or tclsh, building local bootstrap jimsh0
Usage: configure [options]</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This is autosetup, a faster, better alternative to autoconf.
Use the --manual option for the full autosetup manual, including
standard autosetup options.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Local options:
  --shared            Create a shared library
  --disable-utf8      Disable utf8 support</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_3_5_no_separate_generate_run_step">3.5. No separate generate/run step</h3>
<div class="paragraph"><p>autosetup parses <em>auto.def</em> and updates the configuration in a single step. This simplifies and speeds development. It also means that both developers and users (those building the project from source) follow the same configure/build procedure.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_writing_auto_def_files">4. Writing auto.def files</h2>
<div class="sectionbody">
<div class="paragraph"><p><em>auto.def</em> files are generally simple to write, but have the full power of Tcl if required for implementing complex checks or option processing. The <em>auto.def</em> file is structured as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>use</em> optional modules
</p>
</li>
<li>
<p>
<em>options</em> declaration
</p>
</li>
<li>
<p>
environment checks and option processing
</p>
</li>
<li>
<p>
template, header file and other output generation
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_4_1_optional_modules">4.1. Optional modules</h3>
<div class="paragraph"><p>autosetup includes the common, optional modules <em>cc</em> and <em>cc-shared</em>. If these modules are required, the <strong>must</strong> be declared <strong>before</strong> <em>options</em> so that any module-specific options can be recognised.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt># This project checks for C/C++ features
use cc
# And supports shared libraries/shared objects
use cc-shared</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>options { ... }</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_4_2_declaring_user_options">4.2. Declaring User Options</h3>
<div class="paragraph"><p>Allowed options are defined using the <em>options</em> declaration in the <em>auto.def</em> file.</p></div>
<div class="paragraph"><p><strong>Note</strong>: Every auto.def <strong>must</strong> have an <em>options</em> declaration immediately after any <em>use</em> declarations, even if it is empty. This ensures that <em>configure --help</em> behaves correctly.</p></div>
<div class="paragraph"><p>Options are declared as follows.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>options {
    boolopt            =&gt; "a boolean option which defaults to disabled"
    boolopt2=1         =&gt; "a boolean option which defaults to enabled"
    stringopt:         =&gt; "an option which takes an argument, e.g. --stringopt=value"
    stringopt2:=value  =&gt; "an option where the argument is optional and defaults to 'value'"
    optalias booltopt3 =&gt; "a boolean with a hidden alias. --optalias is not shown in --help"
    boolopt4 =&gt; {
        Multiline description for this option
        which is carefully formatted.
    }
}</tt></pre>
</div></div>
<div class="paragraph"><p>The <em>&#8658;</em> syntax is used to indicate the help description for the option. If an option is not followed by <em>&#8658;</em>, the option is not displayed in <em>--help</em> but is still available.</p></div>
<div class="paragraph"><p>If the first character of the help description is a newline (as for <em>boolopt4</em>), the description will not be reformatted.</p></div>
<div class="paragraph"><p>String options can be specified multiple times, and all given values are available. If there is no default value, the value must be specified.</p></div>
<div class="paragraph"><p>Within <em>auto.def</em>, options are checked with the commands <em>opt-bool</em> and <em>opt-val</em>.</p></div>
</div>
<div class="sect2">
<h3 id="_4_3_setting_options">4.3. Setting Options</h3>
<div class="paragraph"><p>Boolean options can be enabled or disabled with one of the following forms (some of which are for autoconf compatibility):</p></div>
<div class="paragraph"><p>To <strong>enable</strong> an option:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>--boolopt
--enable-boolopt
--boolopt=1
--boolopt=yes</tt></pre>
</div></div>
<div class="paragraph"><p>To <strong>disable</strong> an option:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>--disable-boolopt
--boolopt=0
--boolopt=no</tt></pre>
</div></div>
<div class="paragraph"><p>String options must have a value specified, unless the option has a default value.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>--stropt          - OK if a default value is given for stropt
--stropt=value    - Adds the given value for the option</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_4_4_configuration_variables">4.4. Configuration Variables</h3>
<div class="paragraph"><p>At it&#8217;s heart, autosetup is about examining user options, performing checks and setting configuration variables representing the options and environment. These variables are set either directly with the <em>define</em> or <em>define-feature</em> commands, or indirectly via one of the test commands such as <em>cc-check-includes</em>.</p></div>
<div class="paragraph"><p>All configuration variables are available for template substitution (<em>make-template</em>), header file generation (<em>make-autoconf-h</em>) or can be tested and set within <em>auto.def</em>. Certain naming conventions are used to provide expected behaviour.</p></div>
<div class="paragraph"><p>All commands which check for the existence of a feature, use HAVE_xxx as the name of the corresponding variable (this is autoconf compatible). See <em>feature-define-name</em> for the rules used to convert a feature name to a variable name.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>cc-check-includes time.h sys/types.h      =&gt; HAVE_TIME_H HAVE_SYS_TYPES_H
cc-check-functions strlcat                =&gt; HAVE_STRLCAT
cc-check-types "long long" "struct stat"  =&gt; HAVE_LONG_LONG HAVE_STRUCT_STAT</tt></pre>
</div></div>
<div class="paragraph"><p>These two are equivalent:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>have-feature sys/types.h
get-define HAVE_SYS_TYPE_H</tt></pre>
</div></div>
<div class="paragraph"><p><em>cc-check-sizeof</em> uses the SIZEOF_ prefix rather than the HAVE_ prefix.</p></div>
<div class="paragraph"><p>Variables used to store command names are simply the uppercase of the base command.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>CC              - The C compiler
LD              - The linker
AR              - ar
RANLIB          - ranlib</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_4_5_configure">4.5. configure</h3>
<div class="paragraph"><p>In order to provide compatibility with autoconf, and to simplify out-of-tree builds, autosetup can be run via a simple <em>configure</em> script. The following script is created by <em>autosetup --init</em>.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>#!/bin/sh
dir="$(dirname "$0")/autosetup"
WRAPPER="$0" exec $("$dir/find-tclsh" || echo false) "$dir/autosetup" "$@"</tt></pre>
</div></div>
<div class="paragraph"><p>This script invokes autosetup in the autosetup/ subdirectory after setting the <em>WRAPPER</em> environment variable.</p></div>
<div class="paragraph"><p><em>autosetup --init</em> will create this script if it doesn&#8217;t exist.</p></div>
</div>
<div class="sect2">
<h3 id="_4_6_checking_features">4.6. Checking Features</h3>
<div class="paragraph"><p>Apart from checking user options, the primary purpose of autosetup and <em>auto.def</em> is to check for the availability of features in the environment. The <em>cc</em> module provides commands to check various settings by compiling small test programs with the specified C compiler. The following is a typical example:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>use cc
options {}
cc-check-types "long long"
cc-check-includes sys/un.h
cc-check-functions regcomp waitpid sigaction
cc-check-tools ar ranlib strip</tt></pre>
</div></div>
<div class="paragraph"><p>See the command reference for details of these built-in checks.</p></div>
</div>
<div class="sect2">
<h3 id="_4_7_selecting_the_language">4.7. Selecting the Language</h3>
<div class="paragraph"><p>The low level <em>cctest</em> commands provides the <em>-lang</em> option to select the language to use for tests. This can be used in conjunction with <em>cc-with</em> to set the language for a series of tests.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>cc-with {-lang c++} {
    # All tests now use the C++ compiler -- $(CXX) and $(CXXFLAGS)
    cc-check-types bool
}
# Or just set it for the rest of the file
cc-with {-lang c++}
...</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_4_8_controlling_the_build">4.8. Controlling the build</h3>
<div class="paragraph"><p>Once the user options have been processed and the environment checked for supported features, it is necessary to use this information to control the build. The <em>cc</em> module provides two mechanisms for this:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>make-template</em> creates a file from a template by applying substitutions based on the configuration variables. For example, replacing <em>@CC@</em> with <em>arm-linux-gcc</em>.
</p>
</li>
<li>
<p>
<em>make-autoconf-h</em> creates a C/C++ header file based on the configuration variables
</p>
</li>
</ul></div>
<div class="paragraph"><p>It is easy to create other file formats based on configuration variables. For example, to produce configuration files in the Linux <em>kconfig</em> format. It is also possible to output configuration variables in Makefile format.</p></div>
<div class="paragraph"><p>autosetup has far more control over generating files to control the build than autoconf since the configuration variables are directly accessible in <em>Tcl</em> from <em>auto.def</em>. See <em>all-defines</em> and <em>examples/testbed/auto.def</em>.</p></div>
</div>
<div class="sect2">
<h3 id="_4_9_a_standard_makefile_in">4.9. A "standard" Makefile.in</h3>
<div class="paragraph"><p>If autosetup is being used to control a make-based build system, the use of a a <em>Makefile.in</em> with a standard structure will provide behaviour similar to that provided by autoconf/automake systems. autosetup provides a typical <em>Makefile.in</em> in <em>examples/typical/Makefile.in</em>. This example provides the following:</p></div>
<div class="ulist"><ul>
<li>
<p>
Use CC, AR, RANLIB as determined by cross compiler settings or user overrides
</p>
</li>
<li>
<p>
Install to --prefix, overridable with DESTDIR
</p>
</li>
<li>
<p>
Use VPATH to support out-of-tree builds
</p>
</li>
<li>
<p>
Dummy automake targets to allow for use as a subproject with automake
</p>
</li>
<li>
<p>
Automatically reconfigure if auto.def changes
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_command_reference">5. Command Reference</h2>
<div class="sectionbody">
<div class="paragraph"><p>autosetup provides a number of built-in commands which are documented below. These may be used from <em>auto.def</em> to test for features, define variables create files from templates and other similar actions.</p></div>
<div class="paragraph"><p>This commands are all implemented as Tcl procedures. Custom commands may be added simply by defining additional Tcl procedures in the <em>auto.def</em> file, and custom modules may be added by creating files with a <em>.tcl</em> extension in the autosetup directory.</p></div>
<div class="sect2">
<h3 id="_5_1_core_commands">5.1. Core Commands</h3>
<div class="dlist"><dl>
<dt class="hdlist1">
opt-bool option &#8230;
</dt>
<dd>
<p>
Check each of the named, boolean options and return 1 if any of them have
been set by the user.
</p>
</dd>
<dt class="hdlist1">
opt-val option-list ?default=""?
</dt>
<dd>
<p>
Returns a list containing all the values given for the non-boolean options in <em>option-list</em>.
There will be one entry in the list for each option given by the user, including if the
same option was used multiple times.
If only a single value is required, use something like:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>lindex [opt-val $names] end</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
If no options were set, $default is returned (exactly, not as a list).
</p>
</dd>
<dt class="hdlist1">
define name ?value=1?
</dt>
<dd>
<p>
Defines the named variable to the given value.
These name, values pairs represent the results of the configuration check
and are available to be checked, modified and substituted.
</p>
</dd>
<dt class="hdlist1">
define-append name value
</dt>
<dd>
<p>
Appends the given value to the given <em>defined</em> variable.
If the variable is not defined or empty, it is set to $value.
Otherwise the value is appended, separated by a space.
</p>
</dd>
<dt class="hdlist1">
get-define name ?default=0?
</dt>
<dd>
<p>
Returns the current value of the <em>defined</em> variable, or $default
if not set.
</p>
</dd>
<dt class="hdlist1">
is-defined name
</dt>
<dd>
<p>
Returns 1 if the given variable is defined.
</p>
</dd>
<dt class="hdlist1">
all-defines
</dt>
<dd>
<p>
Returns a dictionary (name value list) of all defined variables.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
This is suitable for use with <em>dict</em>, <em>array set</em> or <em>foreach</em>
and allows for arbitrary processing of the defined variables.
</p>
</dd>
<dt class="hdlist1">
get-env name default
</dt>
<dd>
<p>
If $name was specified on the command line, return it.
If $name was set in the environment, return it.
Otherwise return $default.
</p>
</dd>
<dt class="hdlist1">
readfile filename ?default=""?
</dt>
<dd>
<p>
Return the contents of the file, without the trailing newline.
If the doesn&#8217;t exist or can&#8217;t be read, returns $default.
</p>
</dd>
<dt class="hdlist1">
writefile filename value
</dt>
<dd>
<p>
Creates the given file containing $value.
Does not add an extra newline.
</p>
</dd>
<dt class="hdlist1">
find-executable name
</dt>
<dd>
<p>
Searches the path for an executable with the given name.
Returns 1 if found, or 0 if not.
</p>
</dd>
<dt class="hdlist1">
find-an-executable ?-required? name &#8230;
</dt>
<dd>
<p>
Given a list of possible executable names,
searches for one of these on the path.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
Returns the name found, or "" if none found.
If the first parameter is <em>-required</em>, an error is generated
if no executable is found.
</p>
</dd>
<dt class="hdlist1">
configlog msg
</dt>
<dd>
<p>
Writes the given message to the configuration log, config.log
</p>
</dd>
<dt class="hdlist1">
msg-checking msg
</dt>
<dd>
<p>
Writes the message with no newline to stdout.
</p>
</dd>
<dt class="hdlist1">
msg-result msg
</dt>
<dd>
<p>
Writes the message to stdout.
</p>
</dd>
<dt class="hdlist1">
user-error msg
</dt>
<dd>
<p>
Indicate incorrect usage to the user, including if required components
or features are not found.
autosetup exits with a non-zero return code.
</p>
</dd>
<dt class="hdlist1">
user-notice msg
</dt>
<dd>
<p>
Output the given message to stderr.
</p>
</dd>
<dt class="hdlist1">
use module &#8230;
</dt>
<dd>
<p>
Load the given library modules.
e.g. use cc cc-shared
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_5_2_module_cc_shared">5.2. Module: cc-shared</h3>
<div class="dlist"><dl>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
Module which provides support for shared libraries and shared objects.
Defines the following variables:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>SH_CFLAGS         Flags to use compiling sources destined for a shared library
SH_LDFLAGS        Flags to use linking a shared library
SHOBJ_CFLAGS      Flags to use compiling sources destined for a shared object
SHOBJ_LDFLAGS     Flags to use linking a shared object
SH_LINKFLAGS      Flags to use linking an executable which will load shared objects
LD_LIBRARY_PATH   Environment variable which specifies path to shared libraries</tt></pre>
</div></div>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_5_3_module_cc">5.3. Module: cc</h3>
<div class="dlist"><dl>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
This module supports checking various <em>features</em> of the C or C++
compiler/linker environment. Common commands are cc-check-includes,
cc-check-types, cc-check-functions, cc-with, make-autoconf-h and make-template.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
The following environment variables are used if set:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>CC       - C compiler
CXX      - C++ compiler
CFLAGS   - Additional C compiler flags
CXXFLAGS - Additional C++ compiler flags
LDFLAGS  - Additional compiler flags during linking
LIBS     - Additional libraries to use (for all tests)
CROSS    - Tool prefix for cross compilation</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
The following variables are defined from the corresponding
environment variables if set.
</p>
<div class="literalblock">
<div class="content">
<pre><tt>CPPFLAGS
LINKFLAGS
CC_FOR_BUILD
LD</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
have-feature name ?default=0?
</dt>
<dd>
<p>
Returns the value of the feature if defined, or $default if not.
</p>
</dd>
<dt class="hdlist1">
define-feature name ?value=1?
</dt>
<dd>
<p>
Sets the feature <em>define</em> to the given value.
</p>
</dd>
<dt class="hdlist1">
feature-checked name
</dt>
<dd>
<p>
Returns 1 if the feature has been checked, whether true or not
</p>
</dd>
<dt class="hdlist1">
feature-define-name name ?prefix=HAVE_?
</dt>
<dd>
<p>
Converts a name to the corresponding define,
e.g. sys/stat.h becomes HAVE_SYS_STAT_H.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
Converts * to P and all non-alphanumeric to underscore.
</p>
</dd>
<dt class="hdlist1">
cc-check-sizeof type &#8230;
</dt>
<dd>
<p>
Checks the size of the given types (between 2 and 32).
Defines a variable with the size determined, or "unknown" otherwise.
e.g. for type <em>long long</em>, defines SIZEOF_LONG_LONG.
Returns the size of the last type.
</p>
</dd>
<dt class="hdlist1">
cc-check-includes includes &#8230;
</dt>
<dd>
<p>
Checks that the given include files can be used
</p>
</dd>
<dt class="hdlist1">
cc-check-types type &#8230;
</dt>
<dd>
<p>
Checks that the types exist.
</p>
</dd>
<dt class="hdlist1">
cc-check-functions function &#8230;
</dt>
<dd>
<p>
Checks that the given functions exist (can be linked)
</p>
</dd>
<dt class="hdlist1">
cc-check-members type.member &#8230;
</dt>
<dd>
<p>
Checks that the given type/structure members exist.
A structure member is of the form "struct stat.st_mtime"
</p>
</dd>
<dt class="hdlist1">
cc-check-function-in-lib function libs ?otherlibs?
</dt>
<dd>
<p>
Checks that the given given function can be found on one of the libs.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
First checks for no library required, then checks each of the libraries
in turn.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
If the function is found, the feature is defined and lib_$function is defined
to -l$lib where the function was found, or "" if no library required.
In addition, -l$lib is added to the LIBS define.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
If additional libraries may be needed to linked, they should be specified
as $extralibs as "-lotherlib1 -lotherlib2".
These libraries are not automatically added to LIBS.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
Returns 1 if found or 0 if not.
</p>
</dd>
<dt class="hdlist1">
cc-check-tools tool &#8230;
</dt>
<dd>
<p>
Checks for existence of the given compiler tools, taking
into account any cross compilation prefix.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
For example, when checking for "ar", first AR is checked on the command
simply "ar" is assumed depending upon whether cross compiling.
The path is searched for this executable, and if found AR is defined
to the executable name.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
It is an error if the executable is not found.
</p>
</dd>
<dt class="hdlist1">
cc-check-progs prog &#8230;
</dt>
<dd>
<p>
Checks for existence of the given executables on the path.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
For example, when checking for "grep", the path is searched for
the executable, <em>grep</em>, and if found GREP is defined as "grep".
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
It the executable is not found, the variable is defined as false.
Returns 1 if all programs were found, or 0 otherwise.
</p>
</dd>
<dt class="hdlist1">
cc-with settings ?{ script }?
</dt>
<dd>
<p>
Sets the given <em>cctest</em> settings and then runs the tests in <em>script</em>.
Note that settings such as -lang replace the current setting, while
those such as -includes are appended to the existing setting.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
If no script is given, the settings become the default for the remainder
of the auto.def file.
</p>
<div class="literalblock">
<div class="content">
<pre><tt>cc-with {-lang c++} {
  # This will check with the C++ compiler
  cc-check-types bool
  cc-with {-includes signal.h} {
    # This will check with the C++ compiler, signal.h and any existing includes.
    ...
  }
  # back to just the C++ compiler
}</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
The -libs setting is special in that newer values are added <strong>before</strong> earlier ones.
</p>
<div class="literalblock">
<div class="content">
<pre><tt>cc-with {-libs {-lc -lm}} {
  cc-with {-libs -ldl} {
    cctest -libs -lsocket ...
    # libs will be in this order: -lsocket -ldl -lc -lm
  }
}</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
cctest ?settings?
</dt>
<dd>
<p>
Low level C compiler checker. Compiles and or links a small C program
according to the arguments and returns 1 if OK, or 0 if not.
</p>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
Supported settings are:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>-cflags cflags      A list of flags to pass to the compiler
-includes list      A list of includes, e.g. {stdlib.h stdio.h}
-declare code       Code to declare before main()
-link 1             Don't just compile, link too
-lang c|c++         Use the C (default) or C++ compiler
-libs liblist       List of libraries to link, e.g. {-ldl -lm}
-code code          Code to compile in the body of main()
-source code        Compile a complete program. Ignore -includes, -declare and -code
-sourcefile file    Shorthand for -source [readfile [get-define srcdir]/$file]</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
Unless -source or -sourcefile is specified, the C program looks like:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>#include &lt;firstinclude&gt;   /* same for remaining includes in the list */</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>declare-code              /* any code in -declare, verbatim */</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>int main(void) {
  code                    /* any code in -code, verbatim */
  return 0;
}</tt></pre>
</div></div>
</dd>
<dt class="hdlist1">
 
</dt>
<dd>
<p>
Any failures are recorded in <em>config.log</em>
</p>
</dd>
</dl></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_6_examples">6. Examples</h2>
<div class="sectionbody">
<div class="paragraph"><p>autosetup includes a number of examples, including:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>examples/typical</em> - A simple, but full featured example
</p>
</li>
<li>
<p>
<em>examples/minimal</em> - A minimal example
</p>
</li>
<li>
<p>
<em>examples/jimtcl</em> - The Jim Tcl project uses autosetup
</p>
</li>
</ul></div>
<div class="paragraph"><p>These examples can be found along with the autosetup source at <a href="https://github.com/msteveb/autosetup">https://github.com/msteveb/autosetup</a></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_7_tips_on_moving_from_autoconf">7. Tips on moving from autoconf</h2>
<div class="sectionbody">
<div class="paragraph"><p>autosetup attempts to be reasonably compatible with an autoconf-generated <em>configure</em> script. Some differences are noted below.</p></div>
<div class="sect2">
<h3 id="_7_1_no_target_no_need_for_build">7.1. No --target, no need for --build</h3>
<div class="paragraph"><p>While autosetup has good cross compile support with <em>--host</em>, it has no explicit support for <em>--target</em> (which is almost never needed).</p></div>
<div class="paragraph"><p>Additionally, --build is rarely needed since the build system can be guessed with <em>config.guess</em>.</p></div>
</div>
<div class="sect2">
<h3 id="_7_2_single_variable_namespace">7.2. Single variable namespace</h3>
<div class="paragraph"><p>All variables defined with <em>define</em> and <em>define-feature</em> use a single namespace. This essentially means that AC_SUBST and AC_DEFINE are equivalent, which simplifies configuration in practice.</p></div>
</div>
<div class="sect2">
<h3 id="_7_3_no_autoheader">7.3. No autoheader</h3>
<div class="paragraph"><p>autosetup has no need for <em>autoheader</em> since a configuration header file can simply be generated directly (see <em>make-autoconf-h</em>) without a template.</p></div>
</div>
<div class="sect2">
<h3 id="_7_4_no_subdirectory_support">7.4. No subdirectory support</h3>
<div class="paragraph"><p>autoconf supports configuring subdirectories with AC_CONFIG_SUBDIRS. autosetup has no explicit support for this feature.</p></div>
</div>
<div class="sect2">
<h3 id="_7_5_no_automake">7.5. No automake</h3>
<div class="paragraph"><p>autosetup is not designed to be used with automake. autosetup is flexible enough to be used with plain <em>make</em>, or other builds systems.</p></div>
</div>
<div class="sect2">
<h3 id="_7_6_no_ac_try_run">7.6. No AC_TRY_RUN</h3>
<div class="paragraph"><p>autosetup has no equivalent of AC_TRY_RUN which attempts to run a test program. This feature is often used unnecessarily, and is useless when cross compiling, which is a core feature of autosetup.</p></div>
</div>
<div class="sect2">
<h3 id="_7_7_modern_platform_assumption">7.7. Modern Platform Assumption</h3>
<div class="paragraph"><p>autoconf includes support for many old and obsolete platforms. Most of these are no longer relevant. autosetup assumes that the build environment is somewhat POSIX compliant. This includes both cygwin and mingw on Windows.</p></div>
<div class="paragraph"><p>Thus, there is no need to check for standard headers such as stdlib.h, string.h, etc.</p></div>
</div>
<div class="sect2">
<h3 id="_7_8_no_ac_prog_xxxx">7.8. No AC_PROG_xxxx</h3>
<div class="paragraph"><p>Use the generic <em>cc-check-progs</em></p></div>
<div class="literalblock">
<div class="content">
<pre><tt>if {![cc-check-progs grep]} {
    user-error "You don't have grep, but we need it"
}
foreach prog {gawk mawk nawk awk} {
    if {[cc-check-progs $prog]} {
        define AWK $prog
        break
    }
}
# If not found, AWK is defined as false</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_7_9_no_ac_func_xxx">7.9. No AC_FUNC_xxx</h3>
<div class="paragraph"><p>Use the generic <em>cc-check-functions</em> instead</p></div>
</div>
<div class="sect2">
<h3 id="_7_10_no_special_commands_to_use_replacement_functions">7.10. No special commands to use replacement functions</h3>
<div class="paragraph"><p>Instead consider something like the following.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt># auto.def: Check all functions
cc-check-functions strtod backtrace</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>/* replacements.c */
#include "config.h"
#ifndef HAVE_STRTOD
double strtod(...) { /* implementation */ }
#endif</tt></pre>
</div></div>
<div class="paragraph"><p>Alternatively, implement each missing function in it&#8217;s own file.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>define EXTRA_OBJS ""
foreach f {strtod backtrace} {
    if {![cc-check-functions $f]} {
        define-append EXTRA_OBJS $f.o
    }
}</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_7_11_default_checks_do_not_use_any_include_files">7.11. Default checks do not use any include files.</h3>
<div class="paragraph"><p>autoconf normally adds certain include files to every test build, such as stdio.h. This can cause problems where declarations in these standard headers conflict with the code being tested. For this reason, autosetup compile tests uses no standard headers. If headers are required, they should be added explicitly.</p></div>
</div>
<div class="sect2">
<h3 id="_7_12_checking_for_includes">7.12. Checking for includes</h3>
<div class="paragraph"><p>When adding includes to a test, <em>cctest</em> will automatically omit any include files which have been checked and do not exist. If any includes have been specified but not checked, a warning is given.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_8_cross_compiling">8. Cross Compiling</h2>
<div class="sectionbody">
<div class="paragraph"><p>In general, cross compilation works the same way as autoconf. Generally this simply means specifying --host=&lt;target-alias&gt;. For example, if you have arm-linux-gcc and related tools, run:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>./configure --host=arm-linux</tt></pre>
</div></div>
<div class="paragraph"><p>If additional compiler options are needed, such as -mbig-endian, these can be specified with <em>CFLAGS</em>. In this case, the default <em>CFLAGS</em> of "-g -O2" won&#8217;t be used so the desired debugging and optimisation flags should also be added.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>./configure --host=arm-linux CFLAGS="-mbig-endian -msoft-float -static-libgcc -g -Os"</tt></pre>
</div></div>
<div class="paragraph"><p>If the compiler and related tools have a non-standard prefix, it may be necessary to set CROSS in addition to --host.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>./configure --host=arm-linux CROSS=my-</tt></pre>
</div></div>
<div class="paragraph"><p>In this case, C the compiler should be named my-cc or my-gcc, and similarly for the other tools. This is usually simpler than specifying CC, AR, RANLIB, STRIP, etc.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_9_installing">9. Installing</h2>
<div class="sectionbody">
<div class="paragraph"><p>Like autoconf, autosetup uses a combination of <em>--prefix</em> and <em>DESTDIR</em> to determine where the project is installed.</p></div>
<div class="paragraph"><p>The <em>--prefix</em> option is used during with <em>./configure</em> to specify the top level installation directory. It defaults to <em>/usr/local</em>. Use <em>--prefix=</em> to install at the top level (e.g. <em>/bin</em>). The application may use this value (via <em>@prefix@</em> or one of the related values such as <em>@bindir@</em>) to find files at runtime.</p></div>
<div class="paragraph"><p>The <em>DESTDIR</em> Makefile variable may be used at installation time to specify an different install root directory. This is especially useful to stage the installed files in a temporary location before they are installed to their final location (e.g. when building a filesystem for an embedded target). It defaults to the empty string (i.e. files are installed to <em>--prefix</em>).</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>./configure --prefix=/usr
make DESTDIR=/tmp/staging install</tt></pre>
</div></div>
<div class="paragraph"><p>autosetup has no special support for installing other than providing <em>--prefix</em>. The use of <em>DESTDIR</em> is by convention. In order to provide expected behaviour, Makefile.in should contain something like:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>prefix = @prefix@
...
install: all
    @echo Installing from @srcdir@ and `pwd` to $(DESTDIR)$(prefix)</tt></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_10_automatic_remaking">10. Automatic remaking</h2>
<div class="sectionbody">
<div class="paragraph"><p>It is convenient for configure to be rerun automatically if any of the input files change (for example autosetup or any of the template files). This can be achieved by adding the following to Makefile.in.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>ifeq ($(findstring clean,$(MAKECMDGOALS)),)
Makefile: @AUTODEPS@ @srcdir@/Makefile.in
        @@AUTOREMAKE@
endif</tt></pre>
</div></div>
<div class="paragraph"><p>It may also be convenient to add a target to force reconfiguring with the same options.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>reconfig:
        @AUTOREMAKE@</tt></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_11_shipping_autosetup">11. Shipping autosetup</h2>
<div class="sectionbody">
<div class="paragraph"><p>autosetup is designed to be deployed directly as part of a project. It is installed as a single subdirectory, autosetup, at the top level of a project.</p></div>
<div class="paragraph"><p>In addition to autosetup, the following files are required for an autosetup-enabled project.</p></div>
<div class="ulist"><ul>
<li>
<p>
auto.def
</p>
</li>
<li>
<p>
configure (generated by autosetup --init)
</p>
</li>
<li>
<p>
Makefile.in (and any other template specified in auto.def)
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_12_extending_autosetup">12. Extending autosetup</h2>
<div class="sectionbody">
<div class="paragraph"><p>Local modules can be added directly to the autosetup directory and loaded with the <em>use</em> command.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_13_future_features_changes">13. Future Features/Changes</h2>
<div class="sectionbody">
<div class="paragraph"><p>Some features are not yet implemented, but are candidates for including in an existing module, or adding to a new module. Others may require changes to the core <em>autosetup</em>.</p></div>
<div class="ulist"><ul>
<li>
<p>
Explicit C++ support
</p>
</li>
<li>
<p>
pkg-config support (although pkg-config has poor support for cross compiling)
</p>
</li>
<li>
<p>
More fully-featured shared library support
</p>
</li>
<li>
<p>
Support for additional languages
</p>
</li>
<li>
<p>
libtool support (if we must!)
</p>
</li>
<li>
<p>
Subdirectory support. Need to resolve how options are parsed, and how variables interact between subdirectories.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_14_motivation">14. Motivation</h2>
<div class="sectionbody">
<div class="paragraph"><p>autoconf does the job and supports many platforms, but it suffers from at least the following problems:</p></div>
<div class="ulist"><ul>
<li>
<p>
Requires configuration descriptions in a combination of m4 and shell scripts
</p>
</li>
<li>
<p>
Creates 10,000 line shell scripts which are slow to run and impossible to debug
</p>
</li>
<li>
<p>
Requires a multi-stage process of aclocal &#8658; autoheader &#8658; autoconf &#8658; configure &#8658; Makefile + config.h
</p>
</li>
</ul></div>
<div class="paragraph"><p>autosetup attempts to address these issues as follows by directly parsing a simple <em>auto.def</em> file, written in Tcl, and directly generating output files such as config.h and Makefile.</p></div>
<div class="paragraph"><p>autosetup runs under either Tcl 8.5, which is available on almost any modern system, or Jim Tcl. Jim Tcl is very easy to build on almost any system in the case where Tcl is not available.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_15_references">15. References</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<a href="http://freshmeat.net/articles/stop-the-autoconf-insanity-why-we-need-a-new-build-system">http://freshmeat.net/articles/stop-the-autoconf-insanity-why-we-need-a-new-build-system</a>
</p>
</li>
<li>
<p>
<a href="http://www.varnish-cache.org/docs/2.1/phk/autocrap.html">http://www.varnish-cache.org/docs/2.1/phk/autocrap.html</a>
</p>
</li>
<li>
<p>
<a href="http://wiki.tcl.tk/27197">http://wiki.tcl.tk/27197</a>
</p>
</li>
<li>
<p>
<a href="http://jim.berlios.de/">http://jim.berlios.de/</a>
</p>
</li>
<li>
<p>
<a href="http://www.gnu.org/software/hello/manual/autoconf/index.html">http://www.gnu.org/software/hello/manual/autoconf/index.html</a>
</p>
</li>
<li>
<p>
<a href="http://www.flameeyes.eu/autotools-mythbuster/index.html">http://www.flameeyes.eu/autotools-mythbuster/index.html</a>
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_15_1_comments_on_autoconf">15.1. Comments on autoconf</h3>
<div class="ulist"><ul>
<li>
<p>
<a href="http://news.ycombinator.com/item?id=1499738">http://news.ycombinator.com/item?id=1499738</a>
</p>
</li>
<li>
<p>
<a href="http://developers.slashdot.org/article.pl?sid=04/05/21/0154219">http://developers.slashdot.org/article.pl?sid=04/05/21/0154219</a>
</p>
</li>
<li>
<p>
<a href="http://www.airs.com/blog/archives/95">http://www.airs.com/blog/archives/95</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_15_2_alternative_autoconf_alternatives">15.2. Alternative autoconf Alternatives</h3>
<div class="ulist"><ul>
<li>
<p>
<a href="http://pmk.sourceforge.net/faq.php">http://pmk.sourceforge.net/faq.php</a> - PMK
</p>
</li>
<li>
<p>
<a href="https://e-reports-ext.llnl.gov/pdf/315457.pdf">https://e-reports-ext.llnl.gov/pdf/315457.pdf</a> - autokonf
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_16_copyright_author_and_licence">16. Copyright, Author and Licence</h2>
<div class="sectionbody">
<div class="paragraph"><p>autosetup is Copyright (c) 2010 WorkWare Systems <a href="http://workware.net.au/">http://workware.net.au/</a></p></div>
<div class="paragraph"><p>autosetup was written by Steve Bennett &lt;<a href="mailto:steveb@workware.net.au">steveb@workware.net.au</a>&gt;</p></div>
<div class="paragraph"><p>autosetup is released under the "2-clause FreeBSD Licence" as follows.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>autosetup - An environment "autoconfigurator"</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Copyright 2010 Steve Bennett &lt;steveb@workware.net.au&gt;</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>1) Redistributions of source code must retain the above copyright
   notice, this list of conditions and the following disclaimer.
2) Redistributions in binary form must reproduce the above
   copyright notice, this list of conditions and the following
   disclaimer in the documentation and/or other materials
   provided with the distribution.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>THIS SOFTWARE IS PROVIDED BY THE WORKWARE SYSTEMS ``AS IS'' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL WORKWARE
SYSTEMS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>The views and conclusions contained in the software and documentation
are those of the authors and should not be interpreted as representing
official policies, either expressed or implied, of WorkWare Systems.</tt></pre>
</div></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2010-12-16 08:00:07 EST
</div>
</div>
</body>
</html>
